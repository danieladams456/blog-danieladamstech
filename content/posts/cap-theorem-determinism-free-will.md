---
title: "CAP Theorem, Determinism, and Free Will"
date: 2023-07-24T20:00:00-04:00
draft: true
---

Recently I listened to [CAP Theorem 23 Years Later with Eric Brewer](https://softwareengineeringdaily.com/2023/05/12/cap-theorem-23-years-later/) on Software Engineering Daily podcast. I didn't recognize the name at first (shame on me), but it was very cool to hear about the CAP theorem from the person that postulated it.

I haven't had a chance to work on distributed systems in real life, but I find the topic fascinating. Coordinated cache eviction was the closest I've come. I read the book [Designing Data Intensive Applications](https://dataintensive.net/) soon after it was released. Besides the in-depth content within, [Martin Kleppmann](https://martin.kleppmann.com/) includes so many footnotes in that book it is the perfect jumping-off point into any other tangent of databases, data processing, or distributed systems. I got halfway through his undergrad [Distributed Systems lecture series](https://www.youtube.com/playlist?list=PLeKd45zvjcDFUEv_ohr_HdUFe97RItdiB) with [lecture notes](https://www.cl.cam.ac.uk/teaching/2122/ConcDisSys/dist-sys-notes.pdf) he taught at Cambridge. I had completely forgotten about that until writing this blog - definitely should revisit soon.

Anyway, back to the [CAP theorem](https://en.wikipedia.org/wiki/CAP_theorem). It says that in a distributed system, only two of Consistency, Availability, and Partition Tolerance can be achieved. We take partitions as a fact of life (cables cut, power outages, etc) so we are only left with trading off Consistency for Availability. This makes logical sense at the shallow level. If I have a cluster that has split down the middle and one side gets a write, that write will not be visible on the other side. The system has a choice to make at this point. Don't give any answer since it could be wrong (Consistency), or give the answer it has (Availability). Different angles on these properties exist, a common one being read availability vs write availability.

As Eric Brewer highlights on the podcast, the CAP theorem can be taken too black-and-white. There are opportunities to find niches of acceptable tradeoff based on the desired goals. For example, Google Cloud Spanner uses Google's TrueTime API to expose time uncertainty. The [Spanner Paper (2012)](https://static.googleusercontent.com/media/research.google.com/en//archive/spanner-osdi2012.pdf) explains how the database commit timing adapts based on how in-sync the clocks are to preserve transaction ordering. This allows Spanner to provide the [highest levels of consistency](https://cloud.google.com/spanner/docs/true-time-external-consistency#what_consistency_guarantees_does_cloud_spanner_provide). While driving to a 30th birthday weekend trip, I listened to [an interview with Peter Mattis](https://www.cockroachlabs.com/big-ideas-podcast/peter-mattis-cockroach-labs/), co-founder and CTO of Cockroach Labs. I knew Cockroach DB had some distributed systems properties, but I didn't realize the VC pitch when starting the company was some ex-Googlers "implementing the Spanner paper."
